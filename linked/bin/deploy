#!/usr/bin/env node

'use strict';

var exec = require('child_process').exec;
var readline = require('readline');
var rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

var stages = 'preview production'.split(' ');

function deploy(stage) {
    exec('cap ' + stage + ' deploy', function (error, stdout, stderr) {
        console.log('stdout: ' + stdout);
        console.log('stderr: ' + stderr);
        if (error !== null) {
            console.log('exec error: ' + error);
        }
    });
}

(function run(index) {
    var stage = stages[index - 1];
    if (!stage) {
        stages.forEach(function (stage, index) {
            console.log((index + 1) + '. ' + stage);
        });
        rl.question('Which stage should be deployed?: ', run);
        return;
    }
    rl.close();
    deploy(stage);
})();
